{% extends "index.html" %}
{% block body%}    

<div class="container mt-3",style="float:center;">
    <h5 class="mb-2">User List</h5>
    <table style="table-layout: fixed; width: 100%", class="table table-bordered">
        <thead class="thead-light">
            {% if role == "Admin"%}
            <tr>
                <th>{{keys[0]}}</th>
                <th>{{keys[1]}}</th>
                <th>{{keys[2]}}</th>
                <th>Admin Actions</th>

               
            </tr>
            {% else %}
            <tr>
                <th>{{keys[0]}}</th>
                <th>{{keys[1]}}</th>
                <th>{{keys[2]}}</th>
               
            </tr>
            
            
            
            
            
            {% endif %}
        </thead>
        <tbody>
            {% if role == "Admin"%}
            {% for user in users %}
            
            <tr >
                <td >{{ user.username }}</td>
                <td >{{ user.Email }}</td>
                <td style="word-wrap: break-word">{{ user.password }}</td>
                <td><input type="button" class="btn btn-danger" value="Delete" id={{user.username}} onclick="deleteUser(id)" /></td>
                
            </tr>
            {% endfor %}
            {% else %}
            {% for user in users %}
            
            <tr >
                <td >{{ user.username }}</td>
                <td >{{ user.Email }}</td>
                <td style="word-wrap: break-word">***********</td>
                
            </tr>
            {% endfor %}











            {% endif %}
            
        </tbody>
    </table>
</div>      

<div class="mt-5", style="text-align:center;">  
<input type="button" value="Back to Dashboard" onclick="window.location.href='/dash'"/>

<div class="mt-1"   style="text-align:center;">
<input type="button" value="Logout" onclick="window.location.href='/logout'"/>
</div>
</div>

<script>

function deleteUser(user) {
    if (confirm("Are you sure you want to delete this user?")) {
        // User clicked "OK"
        // Perform the delete action here
        fetch('/deleteUser', {
            method: 'POST', // Use POST for actions that change data
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "username": user })
        })
        .then(response => {
            if (response.ok) {
                alert("User deleted successfully.");
                location.reload(); // Reload the page to reflect changes
            } else {
                alert("Failed to delete user.");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("An error occurred while deleting the user.");
        });
    } else {
        // User clicked "Cancel"
        alert("User deletion canceled.");
    }
}



</script>




{% endblock %}